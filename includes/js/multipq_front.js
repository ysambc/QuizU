jQuery(document).ready(function(e){var s=function(e){mpqElem=e,mpqId=mpqElem.attr("data-id"),quizNonce=mpqElem.attr("data-first"),mpqBase={},selQuestion={},optIds={},currentQuestion=mpqElem.find(".next").attr("data-current"),currentPath=mpqElem.find(".next").attr("data-path"),selResult={},selResult.scoreTrayectory={},quizProgressBase={},summScores={},summScores.total={},summScores.highest={},void 0!==localStorage.mpqQuizesQuestions&&(mpqBase=JSON.parse(localStorage.mpqQuizesQuestions)),mpqQuestions=mpqBase[mpqId],void 0!==localStorage.mpqQuizesResults?(mpqResults=JSON.parse(localStorage.mpqQuizesResults),mpqId in mpqResults&&(selResult=mpqResults[mpqId])):mpqResults={}},t=function(){e.ajax({url:mpqObj.ajaxurl,data:{action:"multipq_front_ajax",_ajax_nonce:quizNonce,mpq_id:mpqId,command:"first"},type:"POST",dataType:"json",beforeSend:function(e){delete mpqBase[mpqId],mpqElem.find(".reset").attr("disabled")},success:function(e){mpqBase[e.id]=e,mpqBase[e.id].timestamp=new Date(2017,6,1),mpqQuestions=mpqBase[e.id],localStorage.setItem("mpqQuizesQuestions",JSON.stringify(mpqBase)),s(mpqElem),mpqElem.find(".reset").html(mpqObj.reset)},complete:function(e,s){mpqElem.find(".reset").removeAttr("style")}})},o=function(){sessionStorage.removeItem("mpqQuizProgress"),n();var s=e('<button disabled class="reset" style="background-color: '+mpqObj.defaultColor+';">'+mpqObj.reset+"</button>");mpqElem.append(s),mpqElem.find(".question").html(mpqObj.error),t()},n=function(){mpqElem.find(".reset").remove(),mpqElem.removeClass("multiple_choice"),mpqElem.removeClass("essay_type"),mpqElem.find(".result").remove(),mpqElem.find(".jssocials").remove(),mpqElem.find(".option_next").remove(),mpqElem.find(".open_answer").remove(),mpqElem.find(".score").remove(),mpqElem.find(".option_score").remove(),mpqElem.find(".email").remove()},r=function(s){isResult=!1,linkId=mpqElem.find(".option_next.checked").attr("data-linkid"),linkPath=mpqElem.find(".option_next.checked").attr("data-linkpath"),"undefined"!=typeof goFinalize&&1==goFinalize&&(linkId="finalize"),s&&(linkId=mpqElem.find(".option_next:first").attr("data-linkid"),linkPath=mpqElem.find(".option_next:first").attr("data-linkpath"),mpqElem.find(".option_next.checked").each(function(){optIds[e(this).attr("data-id")]=e(this).attr("data-id")})),"true"==mpqQuestions.questions[currentPath].questions[currentQuestion].essay_flag&&(essay_options=mpqQuestions.questions[currentPath].questions[currentQuestion].options.essay.essay,chosen_essay=mpqElem.find(".open_answer").val(),e.each(essay_options,function(e,s){s.value.toLowerCase()==chosen_essay.toLowerCase()&&s.link&&(linkId=s.link.linkid,linkPath=s.link.linkpath)})),("results_by_total"==mpqQuestions.resultsCriteriaFlag||"results_by_option"==mpqQuestions.resultsCriteriaFlag)&&linkId in mpqQuestions.results&&(linkId="finalize"),linkId in mpqQuestions.results&&(isResult=!0,selResult=mpqQuestions.results[linkId],selResult||(selResult=mpqQuestions.results[mpqResults[mpqId].id])),!isResult&&linkPath in mpqQuestions.questions&&linkId in mpqQuestions.questions[linkPath].questions?selQuestion=mpqQuestions.questions[linkPath].questions[linkId]:(isResult||selQuestion||o(),selQuestion=!1),"finalize"==linkId?(isResult=!0,m(),"results_by_total"==mpqQuestions.resultsCriteriaFlag&&e.each(mpqQuestions.results,function(e,s){if(parseInt(s.score.min)<=parseInt(quizProgress.summScores.total)&&parseInt(quizProgress.summScores.total)<=parseInt(s.score.max))return Object.assign(selResult,s),!1}),"results_by_option"==mpqQuestions.resultsCriteriaFlag&&e.each(mpqQuestions.results,function(e,s){if(s.highest==quizProgress.summScores.highest)return Object.assign(selResult,s),!1}),selResult.id||(console.log("here"),Object.assign(selResult,mpqQuestions.results[Object.keys(mpqQuestions.results)[0]]))):m(),isResult?void 0===selResult.id?o():a():selQuestion?u():(l(),linkPath==currentPath&&selQuestion.id==mpqQuestions.questions[currentPath].questions[Object.keys(mpqQuestions.questions[currentPath].questions)[0]].id?"results_by_total"==mpqQuestions.resultsCriteriaFlag||"results_by_option"==mpqQuestions.resultsCriteriaFlag?(goFinalize=!0,r(),goFinalize=!1):(selResult=mpqQuestions.results[Object.keys(mpqQuestions.results)[0]],selResult.scoreTrayectory=quizProgress,a()):u())},l=function(){if(mpqQuestions){currentQuestion=mpqElem.find(".next").attr("data-current"),currentPath=mpqElem.find(".next").attr("data-path");var s=mpqQuestions.questions[currentPath].questions,t=!1;e.each(s,function(e,s){if(selQuestion=s,1==t)return!1;s.id==currentQuestion&&(t=!0)}),pathFound=!1,selQuestion.id==currentQuestion&&e.each(mpqQuestions.questions,function(e,s){if(linkPath=s.id,selQuestion=s.questions[Object.keys(s.questions)[0]],1==pathFound)return!1;s.id==currentPath&&(pathFound=!0)})}},u=function(){linkPath&&"undefined"!=linkPath&&"undefined"!=typeof linkPath||(linkPath=currentPath),currentColor=mpqQuestions.questions[linkPath].color,n(),"true"==selQuestion.multiple_choice_flag?mpqElem.addClass("multiple_choice"):mpqElem.removeClass("multiple_choice"),"true"==selQuestion.essay_flag?mpqElem.addClass("essay_type"):mpqElem.removeClass("essay_type"),mpqElem.find(".question").html(selQuestion.title),e.each(selQuestion.options,function(s,t){if("true"==selQuestion.essay_flag&&"essay"!=t.id)return!0;if("true"!=selQuestion.essay_flag&&"essay"==t.id)return!0;var o,i='<p style="background-color: '+currentColor+';">'+t.value+"</p>",n=e("<div></div>").attr({class:"option_next","data-id":"essay","data-result":"false",value:mpqObj.next,"data-linkid":t.link.linkid,"data-linkpath":""==t.link.linkpath?mpqElem.find(".next").attr("data-path"):t.link.linkpath});if("essay"==t.id?(n.attr("data-id","essay"),o='<input type="text" class="open_answer" placeholder="'+t.value+'">',i='<p style="background-color: '+currentColor+';">'+mpqObj.next+"</p>"):n.attr("data-id",t.id),t.img.url)var r=e('<img class="option_image" src="'+t.img.url+'" height="50" width="50">');n.append(i).append(r),mpqElem.find(".next").before(n),mpqElem.find(".option_next").before(o)}),mpqElem.find(".next").attr("data-current",selQuestion.id),mpqElem.find(".next").attr("data-path",""==linkPath||"undefined"==linkPath||"undefined"==typeof linkPath?mpqElem.find(".next").attr("data-path"):linkPath),mpqElem.find(".next").css({"background-color":currentColor})},a=function(){n();var s=e('<button class="reset" style="background-color: '+mpqObj.currentColor+';">'+mpqObj.reset+"</button>");if(mpqElem.find(".question").html(selResult.title),"<p><br></p>"==selResult.content||""==selResult.content?(selResult.content="",mpqElem.append('<div class="result no-margin">'+selResult.content+"</div>")):mpqElem.append('<div class="result">'+selResult.content+"</div>"),mpqElem.append(s),"true"==mpqQuestions.showScoresFlag&&(mpqElem.find(".result").after('<p class="score">'+mpqObj.totalScore+"<strong> "+selResult.scoreTrayectory.summScores.total+"</strong></p>"),"results_by_option"==mpqQuestions.resultsCriteriaFlag&&(i=1,sortedKeys=Object.keys(selResult.scoreTrayectory.summScores.options).sort(),e.each(sortedKeys,function(e,s){"option_e"==s?mpqElem.find(".reset").before('<p class="option_score">'+mpqObj.optionEssay+" = <strong>"+selResult.scoreTrayectory.summScores.options[s]+"</strong></p>"):(mpqElem.find(".reset").before('<p class="option_score">'+mpqObj.option+" "+(parseInt(s.substr(s.length-1))+1)+" = <strong>"+selResult.scoreTrayectory.summScores.options[s]+"</strong></p>"),i++)}),i=0)),"true"==mpqObj.flags.socialSharingFlag){mpqElem.find(".reset").before('<div class="jssocials"></div>'),mpqElem.find(".reset").after('<button class="email input">'+mpqObj.email+"</div>");var t=["googleplus","facebook","twitter"];/Mobi/.test(navigator.userAgent)&&(t.push("email"),t.push({share:"whatsapp",logo:"fa fa-phone"})),"undefined"!=typeof jsSocials&&mpqElem.find(".jssocials").jsSocials({url:window.location.href,shares:t,showCount:!1,showLabel:!1,shareIn:"popup",text:mpqObj.share+"\n\n"})}mpqResults[mpqId]=selResult,localStorage.setItem("mpqQuizesResults",JSON.stringify(mpqResults))},m=function(){quizProgress={},quizProgress.questions={},quizProgress.summScores={},quizProgress.summScores.options={},sessionStorage.getItem("mpqQuizProgress")&&(quizProgressBase=JSON.parse(sessionStorage.getItem("mpqQuizProgress")),quizProgressBase[mpqId]&&(quizProgress=quizProgressBase[mpqId])),progressCurrent=mpqElem.find(".next").attr("data-current"),progressPath=mpqElem.find(".next").attr("data-path"),progressCount=0,progressCurrentOptions=mpqQuestions.questions[progressPath].questions[progressCurrent].options,progressOptionCount=0,progressCount=Object.keys(quizProgress.questions).length,quizProgress.questions["question_"+progressCount]={},quizProgress.questions["question_"+progressCount].option={},quizProgress.questions["question_"+progressCount].id=progressCurrent,e.each(progressCurrentOptions,function(e,s){s.id in optIds&&(progressOptionFound=s,optionCounted=progressOptionCount,"essay"==progressOptionFound.id&&(optionCounted="e"),quizProgress.questions["question_"+progressCount].option[s.id]={},quizProgress.questions["question_"+progressCount].option[s.id]=progressOptionFound,quizProgress.questions["question_"+progressCount].option[s.id].place=optionCounted),"essay"!=s.id&&progressOptionCount++}),progressOptionCount=0,progressCount=0,quizProgress.summScores.total=0,e.each(quizProgress.summScores.options,function(e,s){quizProgress.summScores.options[e]=0}),quizProgress.summScores||(quizProgress.summScores.highest="option_0"),e.each(quizProgress.questions,function(s,t){e.each(t.option,function(s,t){quizProgress.summScores.options["option_"+t.place]||(quizProgress.summScores.options["option_"+t.place]=0),"essay"==t.id?e.each(t.essay,function(e,s){openAnswer.toLowerCase()==s.value.toLowerCase()&&(console.log("chucha"),quizProgress.summScores.options["option_"+t.place]+=parseInt(s.score),quizProgress.summScores.total+=parseInt(s.score))}):(quizProgress.summScores.options["option_"+t.place]+=parseInt(t.score),quizProgress.summScores.total+=parseInt(t.score))})}),sortedKeys=Object.keys(quizProgress.summScores.options).sort(),e.each(sortedKeys,function(e,s){console.log(sortedKeys),console.log(quizProgress.summScores.options[s]),parseInt(quizProgress.summScores.options[s])>=(void 0!==quizProgress.summScores.options[quizProgress.summScores.highest]?quizProgress.summScores.options[quizProgress.summScores.highest]:0)&&(quizProgress.summScores.highest=s)}),quizProgressBase[mpqId]=quizProgress,sessionStorage.setItem("mpqQuizProgress",JSON.stringify(quizProgressBase)),isResult&&(selResult.scoreTrayectory=quizProgress)};window.onerror=t,e(window).on("unload",function(){sessionStorage.removeItem("mpqQuizProgress")}),e(".multipq_widget").each(function(){s(e(this)),mpqBase&&(mpqId in mpqBase||"undefined"==typeof quizNonce)?mpqId in mpqResults&&a():t(),1==mpqObj.flags.isPreview&&t(),mpqElem.addClass("rendered"),mpqElem.on("click",".option_next",function(){if(event.preventDefault(),s(e(this).closest(".multipq_widget")),"essay"==e(this).attr("data-id")){if(!mpqElem.find(".open_answer").val())return void alert(mpqObj.essayError);openAnswer=e(this).closest(".multipq_widget").find(".open_answer").val()}e(this).hasClass("checked")?(currentColor=e(this).find("p").css("outlineColor"),props={"background-color":currentColor,color:""},e(this).removeClass("checked"),e(this).find("p").css(props)):(currentColor=e(this).find("p").css("backgroundColor"),props={color:currentColor,"box-shadow":"inset 0px 0px 0px 2px "+currentColor,"background-color":""},e(this).addClass("checked"),e(this).find("p").css(props)),optIds[e(this).attr("data-id")]=e(this).attr("data-id"),("true"!=mpqQuestions.questions[currentPath].questions[currentQuestion].multiple_choice_flag||"true"==mpqQuestions.questions[currentPath].questions[currentQuestion].multiple_choice_flag&&"true"==mpqQuestions.questions[currentPath].questions[currentQuestion].essay_flag)&&r()}),mpqElem.on("click",".next",function(){if(event.preventDefault(),0!=e(this).closest(".multipq_widget").find(".option_next.checked").length){s(e(this).closest(".multipq_widget"));"true"==mpqQuestions.questions[currentPath].questions[currentQuestion].multiple_choice_flag&&r(!0)}else alert(mpqObj.checkedError)}),mpqElem.on("click",".reset",function(){event.preventDefault(),s(e(this).closest(".multipq_widget")),sessionStorage.removeItem("mpqQuizProgress"),delete mpqResults[mpqId],localStorage.setItem("mpqQuizesResults",JSON.stringify(mpqResults));var t=mpqQuestions.questions.default.questions;for(key in t){selQuestion=mpqQuestions.questions.default.questions[key];break}n(),linkPath="default",u()}),mpqElem.on("click",".email.input",function(){s(e(this).closest(".multipq_widget")),e(this).removeClass("input").addClass("send"),e(this).text(mpqObj.send),e(this).after('<input type="email" class="email address" placeholder="john-doe@example.com" value="'+mpqObj.userEmail+'" autocomplete="on">')}),mpqElem.on("click",".send.email",function(){s(e(this).closest(".multipq_widget")),mpqElem.find(".send.email").attr("disabled","true"),emailNonce=mpqElem.attr("data-email"),title=mpqElem.find(".question").text(),result=mpqElem.find(".result").text(),quiz=mpqElem.find("h3").text(),email=mpqElem.find(".email.address").change().val(),that=e(this),e.ajax({url:mpqObj.ajaxurl,data:{action:"multipq_front_ajax",_ajax_nonce:emailNonce,command:"email",email:email,title:title,content:result,quiz:quiz,mpq_id:mpqId},type:"POST",dataType:"json",beforeSend:function(e){that.html('<i class="fa fa-spinner fa-spin"></i>')},success:function(s){var t={"{{user-email}}":"<br><br><strong>"+email+"</strong>","{{quiz-title}}":quiz,"{{result-title}}":title,"{{result-content}}":result};e.each(mpqObj,function(s,o){"flags"!=s&&e.each(t,function(e,t){for(;-1!==o.indexOf(e);)o=o.replace(e,t),mpqObj[s]=o})}),1==s.success&&(mpqElem.find(".send.email").remove(),mpqElem.find(".email.address").remove(),mpqElem.find(".email.error").remove(),mpqElem.find(".reset").after('<p class="post email">'+mpqObj.postEmail+"</p>")),0==s.success&&(that.html(mpqObj.send),that.removeAttr("disabled"),mpqElem.find(".email.error").remove(),that.after('<p class="email error">'+mpqObj.emailError+"</p>"))},complete:function(e,s){}})}),mpqElem.on("keypress",".email.address",function(t){s(e(this).closest(".multipq_widget")),13===t.which&&mpqElem.find(".send.email").click()})})});