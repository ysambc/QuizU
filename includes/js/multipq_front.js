jQuery(document).ready(function(e){var s=function(e){quizuElem=e,quizuId=quizuElem.attr("data-id"),quizNonce=quizuElem.attr("data-first"),quizuBase={},selQuestion={},optIds={},currentQuestion=quizuElem.find(".next").attr("data-current"),currentPath=quizuElem.find(".next").attr("data-path"),selResult={},selResult.scoreTrayectory={},quizProgressBase={},summScores={},summScores.total={},summScores.highest={},void 0!==localStorage.quizuQuizesQuestions&&(quizuBase=JSON.parse(localStorage.quizuQuizesQuestions)),quizuQuestions=quizuBase[quizuId],void 0!==localStorage.quizuQuizesResults?(quizuResults=JSON.parse(localStorage.quizuQuizesResults),quizuId in quizuResults&&(selResult=quizuResults[quizuId])):quizuResults={}},t=function(){e.ajax({url:quizuObj.ajaxurl,data:{action:"quizu_front_ajax",_ajax_nonce:quizNonce,quizu_id:quizuId,command:"first"},type:"POST",dataType:"json",beforeSend:function(e){delete quizuBase[quizuId],quizuElem.find(".reset").attr("disabled")},success:function(e){quizuBase[e.id]=e,quizuBase[e.id].timestamp=new Date(2017,6,1),quizuQuestions=quizuBase[e.id],localStorage.setItem("quizuQuizesQuestions",JSON.stringify(quizuBase)),s(quizuElem),quizuElem.find(".reset").html(quizuObj.reset)},complete:function(e,s){quizuElem.find(".reset").removeAttr("style")}})},o=function(){sessionStorage.removeItem("quizuQuizProgress"),n();var s=e('<button disabled class="reset" style="background-color: '+quizuObj.defaultColor+';">'+quizuObj.reset+"</button>");quizuElem.append(s),quizuElem.find(".question").html(quizuObj.error),t()},n=function(){quizuElem.find(".reset").remove(),quizuElem.removeClass("multiple_choice"),quizuElem.removeClass("essay_type"),quizuElem.find(".result").remove(),quizuElem.find(".jssocials").remove(),quizuElem.find(".option_next").remove(),quizuElem.find(".open_answer").remove(),quizuElem.find(".score").remove(),quizuElem.find(".option_score").remove(),quizuElem.find(".email").remove()},r=function(s){isResult=!1,linkId=quizuElem.find(".option_next.checked").attr("data-linkid"),linkPath=quizuElem.find(".option_next.checked").attr("data-linkpath"),"undefined"!=typeof goFinalize&&1==goFinalize&&(linkId="finalize"),s&&(linkId=quizuElem.find(".option_next:first").attr("data-linkid"),linkPath=quizuElem.find(".option_next:first").attr("data-linkpath"),quizuElem.find(".option_next.checked").each(function(){optIds[e(this).attr("data-id")]=e(this).attr("data-id")})),"true"==quizuQuestions.questions[currentPath].questions[currentQuestion].essay_flag&&(essay_options=quizuQuestions.questions[currentPath].questions[currentQuestion].options.essay.essay,chosen_essay=quizuElem.find(".open_answer").val(),e.each(essay_options,function(e,s){s.value.toLowerCase()==chosen_essay.toLowerCase()&&s.link&&(linkId=s.link.linkid,linkPath=s.link.linkpath)})),("results_by_total"==quizuQuestions.resultsCriteriaFlag||"results_by_option"==quizuQuestions.resultsCriteriaFlag)&&linkId in quizuQuestions.results&&(linkId="finalize"),linkId in quizuQuestions.results&&(isResult=!0,selResult=quizuQuestions.results[linkId],selResult||(selResult=quizuQuestions.results[quizuResults[quizuId].id])),!isResult&&linkPath in quizuQuestions.questions&&linkId in quizuQuestions.questions[linkPath].questions?selQuestion=quizuQuestions.questions[linkPath].questions[linkId]:(isResult||selQuestion||o(),selQuestion=!1),"finalize"==linkId?(isResult=!0,m(),"results_by_total"==quizuQuestions.resultsCriteriaFlag&&e.each(quizuQuestions.results,function(e,s){if(parseInt(s.score.min)<=parseInt(quizProgress.summScores.total)&&parseInt(quizProgress.summScores.total)<=parseInt(s.score.max))return Object.assign(selResult,s),!1}),"results_by_option"==quizuQuestions.resultsCriteriaFlag&&e.each(quizuQuestions.results,function(e,s){if(s.highest==quizProgress.summScores.highest)return Object.assign(selResult,s),!1}),selResult.id||(console.log("here"),Object.assign(selResult,quizuQuestions.results[Object.keys(quizuQuestions.results)[0]]))):m(),isResult?void 0===selResult.id?o():a():selQuestion?u():(l(),linkPath==currentPath&&selQuestion.id==quizuQuestions.questions[currentPath].questions[Object.keys(quizuQuestions.questions[currentPath].questions)[0]].id?"results_by_total"==quizuQuestions.resultsCriteriaFlag||"results_by_option"==quizuQuestions.resultsCriteriaFlag?(goFinalize=!0,r(),goFinalize=!1):(selResult=quizuQuestions.results[Object.keys(quizuQuestions.results)[0]],selResult.scoreTrayectory=quizProgress,a()):u())},l=function(){if(quizuQuestions){currentQuestion=quizuElem.find(".next").attr("data-current"),currentPath=quizuElem.find(".next").attr("data-path");var s=quizuQuestions.questions[currentPath].questions,t=!1;e.each(s,function(e,s){if(selQuestion=s,1==t)return!1;s.id==currentQuestion&&(t=!0)}),pathFound=!1,selQuestion.id==currentQuestion&&e.each(quizuQuestions.questions,function(e,s){if(linkPath=s.id,selQuestion=s.questions[Object.keys(s.questions)[0]],1==pathFound)return!1;s.id==currentPath&&(pathFound=!0)})}},u=function(){linkPath&&"undefined"!=linkPath&&"undefined"!=typeof linkPath||(linkPath=currentPath),currentColor=quizuQuestions.questions[linkPath].color,n(),"true"==selQuestion.multiple_choice_flag?quizuElem.addClass("multiple_choice"):quizuElem.removeClass("multiple_choice"),"true"==selQuestion.essay_flag?quizuElem.addClass("essay_type"):quizuElem.removeClass("essay_type"),quizuElem.find(".question").html(selQuestion.title),e.each(selQuestion.options,function(s,t){if("true"==selQuestion.essay_flag&&"essay"!=t.id)return!0;if("true"!=selQuestion.essay_flag&&"essay"==t.id)return!0;var o,i='<p style="background-color: '+currentColor+';">'+t.value+"</p>",n=e("<div></div>").attr({class:"option_next","data-id":"essay","data-result":"false",value:quizuObj.next,"data-linkid":t.link.linkid,"data-linkpath":""==t.link.linkpath?quizuElem.find(".next").attr("data-path"):t.link.linkpath});if("essay"==t.id?(n.attr("data-id","essay"),o='<input type="text" class="open_answer" placeholder="'+t.value+'">',i='<p style="background-color: '+currentColor+';">'+quizuObj.next+"</p>"):n.attr("data-id",t.id),t.img.url)var r=e('<img class="option_image" src="'+t.img.url+'" height="50" width="50">');n.append(i).append(r),quizuElem.find(".next").before(n),quizuElem.find(".option_next").before(o)}),quizuElem.find(".next").attr("data-current",selQuestion.id),quizuElem.find(".next").attr("data-path",""==linkPath||"undefined"==linkPath||"undefined"==typeof linkPath?quizuElem.find(".next").attr("data-path"):linkPath),quizuElem.find(".next").css({"background-color":currentColor})},a=function(){n();var s=e('<button class="reset" style="background-color: '+quizuObj.currentColor+';">'+quizuObj.reset+"</button>");if(quizuElem.find(".question").html(selResult.title),"<p><br></p>"==selResult.content||""==selResult.content?(selResult.content="",quizuElem.append('<div class="result no-margin">'+selResult.content+"</div>")):quizuElem.append('<div class="result">'+selResult.content+"</div>"),quizuElem.append(s),"true"==quizuQuestions.showScoresFlag&&(quizuElem.find(".result").after('<p class="score">'+quizuObj.totalScore+"<strong> "+selResult.scoreTrayectory.summScores.total+"</strong></p>"),"results_by_option"==quizuQuestions.resultsCriteriaFlag&&(i=1,sortedKeys=Object.keys(selResult.scoreTrayectory.summScores.options).sort(),e.each(sortedKeys,function(e,s){"option_e"==s?quizuElem.find(".reset").before('<p class="option_score">'+quizuObj.optionEssay+" = <strong>"+selResult.scoreTrayectory.summScores.options[s]+"</strong></p>"):(quizuElem.find(".reset").before('<p class="option_score">'+quizuObj.option+" "+(parseInt(s.substr(s.length-1))+1)+" = <strong>"+selResult.scoreTrayectory.summScores.options[s]+"</strong></p>"),i++)}),i=0)),"true"==quizuObj.flags.socialSharingFlag){quizuElem.find(".reset").before('<div class="jssocials"></div>'),quizuElem.find(".reset").after('<button class="email input">'+quizuObj.email+"</div>");var t=["googleplus","facebook","twitter"];/Mobi/.test(navigator.userAgent)&&(t.push("email"),t.push({share:"whatsapp",logo:"fa fa-phone"})),"undefined"!=typeof jsSocials&&quizuElem.find(".jssocials").jsSocials({url:window.location.href,shares:t,showCount:!1,showLabel:!1,shareIn:"popup",text:quizuObj.share+"\n\n"})}quizuResults[quizuId]=selResult,localStorage.setItem("quizuQuizesResults",JSON.stringify(quizuResults))},m=function(){quizProgress={},quizProgress.questions={},quizProgress.summScores={},quizProgress.summScores.options={},sessionStorage.getItem("quizuQuizProgress")&&(quizProgressBase=JSON.parse(sessionStorage.getItem("quizuQuizProgress")),quizProgressBase[quizuId]&&(quizProgress=quizProgressBase[quizuId])),progressCurrent=quizuElem.find(".next").attr("data-current"),progressPath=quizuElem.find(".next").attr("data-path"),progressCount=0,progressCurrentOptions=quizuQuestions.questions[progressPath].questions[progressCurrent].options,progressOptionCount=0,progressCount=Object.keys(quizProgress.questions).length,quizProgress.questions["question_"+progressCount]={},quizProgress.questions["question_"+progressCount].option={},quizProgress.questions["question_"+progressCount].id=progressCurrent,e.each(progressCurrentOptions,function(e,s){s.id in optIds&&(progressOptionFound=s,optionCounted=progressOptionCount,"essay"==progressOptionFound.id&&(optionCounted="e"),quizProgress.questions["question_"+progressCount].option[s.id]={},quizProgress.questions["question_"+progressCount].option[s.id]=progressOptionFound,quizProgress.questions["question_"+progressCount].option[s.id].place=optionCounted),"essay"!=s.id&&progressOptionCount++}),progressOptionCount=0,progressCount=0,quizProgress.summScores.total=0,e.each(quizProgress.summScores.options,function(e,s){quizProgress.summScores.options[e]=0}),quizProgress.summScores||(quizProgress.summScores.highest="option_0"),e.each(quizProgress.questions,function(s,t){e.each(t.option,function(s,t){quizProgress.summScores.options["option_"+t.place]||(quizProgress.summScores.options["option_"+t.place]=0),"essay"==t.id?e.each(t.essay,function(e,s){openAnswer.toLowerCase()==s.value.toLowerCase()&&(console.log("chucha"),quizProgress.summScores.options["option_"+t.place]+=parseInt(s.score),quizProgress.summScores.total+=parseInt(s.score))}):(quizProgress.summScores.options["option_"+t.place]+=parseInt(t.score),quizProgress.summScores.total+=parseInt(t.score))})}),sortedKeys=Object.keys(quizProgress.summScores.options).sort(),e.each(sortedKeys,function(e,s){console.log(sortedKeys),console.log(quizProgress.summScores.options[s]),parseInt(quizProgress.summScores.options[s])>=(void 0!==quizProgress.summScores.options[quizProgress.summScores.highest]?quizProgress.summScores.options[quizProgress.summScores.highest]:0)&&(quizProgress.summScores.highest=s)}),quizProgressBase[quizuId]=quizProgress,sessionStorage.setItem("quizuQuizProgress",JSON.stringify(quizProgressBase)),isResult&&(selResult.scoreTrayectory=quizProgress)};window.onerror=t,e(window).on("unload",function(){sessionStorage.removeItem("quizuQuizProgress")}),e(".quizu_widget").each(function(){s(e(this)),quizuBase&&(quizuId in quizuBase||"undefined"==typeof quizNonce)?quizuId in quizuResults&&a():t(),1==quizuObj.flags.isPreview&&t(),quizuElem.addClass("rendered"),quizuElem.on("click",".option_next",function(){if(event.preventDefault(),s(e(this).closest(".quizu_widget")),"essay"==e(this).attr("data-id")){if(!quizuElem.find(".open_answer").val())return void alert(quizuObj.essayError);openAnswer=e(this).closest(".quizu_widget").find(".open_answer").val()}e(this).hasClass("checked")?(currentColor=e(this).find("p").css("outlineColor"),props={"background-color":currentColor,color:""},e(this).removeClass("checked"),e(this).find("p").css(props)):(currentColor=e(this).find("p").css("backgroundColor"),props={color:currentColor,"box-shadow":"inset 0px 0px 0px 2px "+currentColor,"background-color":""},e(this).addClass("checked"),e(this).find("p").css(props)),optIds[e(this).attr("data-id")]=e(this).attr("data-id"),("true"!=quizuQuestions.questions[currentPath].questions[currentQuestion].multiple_choice_flag||"true"==quizuQuestions.questions[currentPath].questions[currentQuestion].multiple_choice_flag&&"true"==quizuQuestions.questions[currentPath].questions[currentQuestion].essay_flag)&&r()}),quizuElem.on("click",".next",function(){if(event.preventDefault(),0!=e(this).closest(".quizu_widget").find(".option_next.checked").length){s(e(this).closest(".quizu_widget"));"true"==quizuQuestions.questions[currentPath].questions[currentQuestion].multiple_choice_flag&&r(!0)}else alert(quizuObj.checkedError)}),quizuElem.on("click",".reset",function(){event.preventDefault(),s(e(this).closest(".quizu_widget")),sessionStorage.removeItem("quizuQuizProgress"),delete quizuResults[quizuId],localStorage.setItem("quizuQuizesResults",JSON.stringify(quizuResults));var t=quizuQuestions.questions.default.questions;for(key in t){selQuestion=quizuQuestions.questions.default.questions[key];break}n(),linkPath="default",u()}),quizuElem.on("click",".email.input",function(){s(e(this).closest(".quizu_widget")),e(this).removeClass("input").addClass("send"),e(this).text(quizuObj.send),e(this).after('<input type="email" class="email address" placeholder="john-doe@example.com" value="'+quizuObj.userEmail+'" autocomplete="on">')}),quizuElem.on("click",".send.email",function(){s(e(this).closest(".quizu_widget")),quizuElem.find(".send.email").attr("disabled","true"),emailNonce=quizuElem.attr("data-email"),title=quizuElem.find(".question").text(),result=quizuElem.find(".result").text(),quiz=quizuElem.find("h3").text(),email=quizuElem.find(".email.address").change().val(),that=e(this),e.ajax({url:quizuObj.ajaxurl,data:{action:"quizu_front_ajax",_ajax_nonce:emailNonce,command:"email",email:email,title:title,content:result,quiz:quiz,quizu_id:quizuId},type:"POST",dataType:"json",beforeSend:function(e){that.html('<i class="fa fa-spinner fa-spin"></i>')},success:function(s){var t={"{{user-email}}":"<br><br><strong>"+email+"</strong>","{{quiz-title}}":quiz,"{{result-title}}":title,"{{result-content}}":result};e.each(quizuObj,function(s,o){"flags"!=s&&e.each(t,function(e,t){for(;-1!==o.indexOf(e);)o=o.replace(e,t),quizuObj[s]=o})}),1==s.success&&(quizuElem.find(".send.email").remove(),quizuElem.find(".email.address").remove(),quizuElem.find(".email.error").remove(),quizuElem.find(".reset").after('<p class="post email">'+quizuObj.postEmail+"</p>")),0==s.success&&(that.html(quizuObj.send),that.removeAttr("disabled"),quizuElem.find(".email.error").remove(),that.after('<p class="email error">'+quizuObj.emailError+"</p>"))},complete:function(e,s){}})}),quizuElem.on("keypress",".email.address",function(t){s(e(this).closest(".quizu_widget")),13===t.which&&quizuElem.find(".send.email").click()})})});